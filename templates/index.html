<!DOCTYPE html>
<html>
<head>
    <title>Tutor Matematika Budi</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        function sendQuestion(form) {
            event.preventDefault(); // Mencegah pengiriman form default
            var user_input = $(form).find("input[name='user_input']").val(); 
            $.post("/", $(form).serialize(), function(data) {
                $("#conversation").append("<p>Anda: " + user_input + "</p>");
                $("#conversation").append("<p>Budi: " + data.answer + "</p>");
                $(form).find("input[name='user_input']").val(""); 
            });
            return false; 
        }

        $(document).ready(function() {
            $("button[name='clear_conversation']").click(function() {
                $.post("/clear_conversation", function(data) {
                    if (data.message) {
                        alert(data.message);
                        $("#conversation").empty(); 
                    } else {
                        alert("Gagal menghapus riwayat percakapan.");
                    }
                });
            });
        });
    </script>
</head>
<body>
    <h1>Tutor Matematika Budi</h1>
    
    <div id="userForm">
        {% if not user_name %}
        <form method="POST" action="/">
            <input type="text" name="user_name" placeholder="Masukkan nama Anda">
            <button type="submit">Mulai</button>
        </form>
        {% endif %}
    </div>
    
    {% if user_name %}
    <p>Halo, {{ user_name }}!</p>
    <div id="conversation">
        {% for message in conversation %}
        <p>Anda: {{ message.user }}</p>
        <p>Budi: {{ message.budi }}</p>
        {% endfor %}
    </div>
    <div id="chatForm">
        <form method="POST" onsubmit="return sendQuestion(this);">
            <input type="text" name="user_input" placeholder="Tanyakan soal matematika...">
            <button type="submit">Tanya</button>
        </form>
        <form method="POST" action="/">
            <button type="button" name="clear_conversation" value="1">Hapus Riwayat Chat</button>
        </form>
    </div>
    {% endif %}
</body>
</html>
